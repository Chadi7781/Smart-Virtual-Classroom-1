{"ast":null,"code":"var __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n/* eslint-disable react/prop-types */\n\n\nimport composeRefs from '@seznam/compose-react-refs';\nimport { createElement, forwardRef, useCallback, useEffect, useMemo, useRef, useState } from 'react';\nexport const define = (tagName, clazz) => {\n  const isClient = typeof window !== 'undefined';\n  if (isClient && !customElements.get(tagName)) customElements.define(tagName, clazz);\n};\n\nconst dashToPascalCase = str => str.toLowerCase().split('-').map(segment => segment.charAt(0).toUpperCase() + segment.slice(1)).join('');\n\nconst isEvent = prop => {\n  var _a;\n\n  return prop.indexOf('on') === 0 && prop[2] === ((_a = prop[2]) === null || _a === void 0 ? void 0 : _a.toUpperCase());\n};\n\nconst toDomEventName = prop => prop.charAt(2).toLowerCase() + prop.substring(3);\n\nexport function createComponent(tagName, componentProps) {\n  const Component = forwardRef((_a, forwardedRef) => {\n    var {\n      children\n    } = _a,\n        props = __rest(_a, [\"children\"]);\n\n    const [ref, setRef] = useState(null);\n    const setRefCb = useCallback(node => {\n      setRef(node);\n    }, []);\n    const eventHandlers = useRef(new Map());\n    const domProps = useMemo(() => Object.keys(props).filter(prop => !componentProps.has(prop) && !isEvent(prop)).reduce((p, c) => Object.assign(Object.assign({}, p), {\n      [c]: props[c]\n    }), {}), [props]);\n    const wcProps = useMemo(() => Object.keys(props).filter(prop => componentProps.has(prop) || isEvent(prop)).reduce((p, c) => Object.assign(Object.assign({}, p), {\n      [c]: props[c]\n    }), {}), [props]);\n    const listen = useCallback((prop, handler) => {\n      var _a;\n\n      const domEvent = toDomEventName(prop);\n      (_a = eventHandlers.current.get(domEvent)) === null || _a === void 0 ? void 0 : _a();\n      if (!ref || !handler) return;\n      ref.addEventListener(domEvent, handler);\n      eventHandlers.current.set(domEvent, () => {\n        ref.removeEventListener(domEvent, handler);\n      });\n    }, [ref]);\n    const cleanup = useCallback(() => {\n      eventHandlers.current.forEach(fn => fn());\n      eventHandlers.current.clear();\n    }, []);\n    useEffect(() => () => {\n      cleanup();\n    }, []);\n    useEffect(() => {\n      if (!ref) return;\n      Object.keys(wcProps).forEach(prop => {\n        if (isEvent(prop)) {\n          listen(prop, wcProps[prop]);\n          return;\n        }\n\n        if (ref[prop] !== wcProps[prop]) {\n          ref[prop] = wcProps[prop];\n        }\n      });\n    }, [ref, wcProps]);\n    return createElement(tagName, Object.assign({\n      ref: composeRefs(setRefCb, forwardedRef)\n    }, domProps), children);\n  });\n  Component.displayName = dashToPascalCase(tagName);\n  return Component;\n}","map":{"version":3,"sources":["../../src/lib.tsx"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable react/prop-types */\nimport composeRefs from '@seznam/compose-react-refs';\nimport {\n  createElement, forwardRef, HTMLAttributes, useCallback, useEffect, useMemo, useRef, useState,\n} from 'react';\n\nexport const define = (tagName: string, clazz: any) => {\n  const isClient = (typeof window !== 'undefined');\n  if (isClient && !customElements.get(tagName)) customElements.define(tagName, clazz);\n};\n\nconst dashToPascalCase = (str: string) => str\n  .toLowerCase()\n  .split('-')\n  .map((segment) => segment.charAt(0).toUpperCase() + segment.slice(1))\n  .join('');\n\nconst isEvent = (prop: string) => prop.indexOf('on') === 0 && prop[2] === prop[2]?.toUpperCase();\nconst toDomEventName = (prop: string) => prop.charAt(2).toLowerCase() + prop.substring(3);\n\nexport function createComponent<T extends HTMLElement, P extends HTMLAttributes<any> = {}>(\n  tagName: string,\n  componentProps: Set<string>,\n) {\n  const Component = forwardRef<T, P>(({\n    children,\n    ...props\n  }, forwardedRef) => {\n    const [ref, setRef] = useState<T | null>(null);\n    const setRefCb = useCallback((node: T | null) => { setRef(node); }, []);\n    const eventHandlers = useRef(new Map());\n\n    const domProps = useMemo(() => Object.keys(props)\n      .filter((prop) => !componentProps.has(prop) && !isEvent(prop))\n      .reduce((p, c) => ({ ...p, [c]: (props as any)[c] }), {}), [props]);\n\n    const wcProps = useMemo(() => Object.keys(props)\n      .filter((prop) => componentProps.has(prop) || isEvent(prop))\n      .reduce((p, c) => ({ ...p, [c]: (props as any)[c] }), {}), [props]);\n\n    const listen = useCallback((prop: string, handler?: () => void) => {\n      const domEvent = toDomEventName(prop);\n      eventHandlers.current.get(domEvent)?.();\n      if (!ref || !handler) return;\n      ref!.addEventListener(domEvent, handler);\n      eventHandlers.current.set(domEvent, () => { ref!.removeEventListener(domEvent, handler); });\n    }, [ref]);\n\n    const cleanup = useCallback(() => {\n      eventHandlers.current.forEach((fn) => fn());\n      eventHandlers.current.clear();\n    }, []);\n\n    useEffect(() => () => { cleanup(); }, []);\n\n    useEffect(() => {\n      if (!ref) return;\n\n      Object.keys(wcProps).forEach((prop) => {\n        if (isEvent(prop)) {\n          listen(prop, (wcProps as any)[prop]);\n          return;\n        }\n\n        if ((ref as any)[prop] !== (wcProps as any)[prop]) {\n          ((ref as any)[prop] = (wcProps as any)[prop]);\n        }\n      });\n    }, [ref, wcProps]);\n\n    return createElement(tagName, {\n      ref: composeRefs(setRefCb, forwardedRef),\n      ...domProps,\n    }, children);\n  });\n\n  Component.displayName = dashToPascalCase(tagName);\n  return Component;\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}