{"version":3,"file":"hooks.js","sourceRoot":"","sources":["../../src/hooks.ts"],"names":[],"mappings":";;;;;;;;;AAAA,OAAO,EACL,WAAW,EACX,eAAe,EACf,QAAQ,GACT,MAAM,OAAO,CAAC;AACf,OAAO,EAEL,gBAAgB,EAChB,gBAAgB,IAAI,UAAU,EAC9B,UAAU,GAEX,MAAM,YAAY,CAAC;AAEpB,MAAM,IAAI,GAAG,GAAG,EAAE,GAAE,CAAC,CAAC;AAEtB;;GAEG;AACH,MAAM,CAAC,MAAM,SAAS,GAAG,CAAC,GAAwC,EAAE,EAAE;IACpE,MAAM,CAAC,MAAM,EAAE,SAAS,CAAC,GAAG,QAAQ,CAA6B,IAAI,CAAC,CAAC;IAEvE,eAAe,CAAC,GAAG,EAAE;QACnB,SAAe,IAAI;;gBACjB,SAAS,CAAC,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,MAAM,UAAU,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;YACpE,CAAC;SAAA;QAED,IAAI,EAAE,CAAC;IACT,CAAC,EAAE,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC;IAElB,OAAO,MAAM,CAAC;AAChB,CAAC,CAAC;AAOF;;;;;;;GAOG;AACH,MAAM,CAAC,MAAM,gBAAgB,GAAG,CAC9B,GAAwC,EACxC,IAAO,EACP,YAA4B,EACZ,EAAE;IAClB,MAAM,CAAC,KAAK,EAAE,QAAQ,CAAC,GAAG,QAAQ,CAAC,YAAY,CAAC,CAAC;IAEjD,MAAM,QAAQ,GAAG,WAAW,CAC1B,CAAC,GAAG,CAAC,OAAO,KAAK,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,gBAAgB,CAAC,GAAG,CAAC,OAAO,CAAC,EAC7D,CAAC,GAAG,CAAC,OAAO,CAAC,CACd,CAAC;IAEF,MAAM,MAAM,GAAG,WAAW;IACxB,wDAAwD;IACxD,CAAC,KAAqB,EAAE,EAAE,GAAG,QAAQ,CAAC,IAAW,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC,EAC5D,CAAC,QAAQ,EAAE,IAAI,CAAC,CACjB,CAAC;IAEF,eAAe,CAAC,GAAG,EAAE;QACnB,IAAI,GAAG,CAAC,OAAO,KAAK,IAAI;YAAE,OAAO,SAAS,CAAC;QAE3C,IAAI,OAAmB,CAAC;QAExB,SAAe,OAAO;;gBACpB,OAAO,GAAG,MAAM,UAAU,CACxB,GAAG,CAAC,OAAQ,EACZ,CAAC,IAAI,CAAC,EACN,CAAC,CAAC,EAAE,QAAQ,EAAE,EAAE,GAAG,QAAQ,CAAC,QAAe,CAAC,CAAC,CAAC,CAAC,CAChD,CAAC;YACJ,CAAC;SAAA;QAED,OAAO,EAAE,CAAC;QACV,OAAO,GAAG,EAAE,GAAG,OAAO,aAAP,OAAO,uBAAP,OAAO,GAAK,CAAC,CAAC,CAAC;IAChC,CAAC,EAAE,CAAC,GAAG,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC,CAAC;IAExB,OAAO,CAAC,KAAK,EAAG,MAAc,CAAC,CAAC;AAClC,CAAC,CAAC","sourcesContent":["import {\n  useCallback,\n  useLayoutEffect,\n  useState,\n} from 'react';\nimport {\n  PlayerProps,\n  createDispatcher,\n  usePlayerContext as useContext,\n  findPlayer,\n  WritableProps,\n} from '@vime/core';\n\nconst noop = () => {};\n\n/**\n * Returns the closest ancestor player to the given `ref`.\n */\nexport const usePlayer = (ref: React.RefObject<HTMLElement | null>) => {\n  const [player, setPlayer] = useState<HTMLVmPlayerElement | null>(null);\n\n  useLayoutEffect(() => {\n    async function find() {\n      setPlayer((ref.current ? (await findPlayer(ref.current)) : null));\n    }\n\n    find();\n  }, [ref.current]);\n\n  return player;\n};\n\nexport type PropBinding<P extends keyof PlayerProps> = [\n  value: PlayerProps[P],\n  setValue: P extends keyof WritableProps ? ((value: PlayerProps[P]) => void) : undefined,\n];\n\n/**\n * Binds the given `prop` to the closest ancestor player of the given `ref`. When the property\n * changes on the player, this hook will trigger a re-render with the new value.\n *\n * @param ref The ref to start searching from.\n * @param prop The property to bind to.\n * @param defaultValue The initial value of the property until the the player context is bound.\n */\nexport const usePlayerContext = <P extends keyof PlayerProps>(\n  ref: React.RefObject<HTMLElement | null>,\n  prop: P,\n  defaultValue: PlayerProps[P],\n): PropBinding<P> => {\n  const [value, setValue] = useState(defaultValue);\n\n  const dispatch = useCallback(\n    (ref.current === null) ? noop : createDispatcher(ref.current),\n    [ref.current],\n  );\n\n  const setter = useCallback(\n    // eslint-disable-next-line @typescript-eslint/no-shadow\n    (value: PlayerProps[P]) => { dispatch(prop as any, value); },\n    [dispatch, prop],\n  );\n\n  useLayoutEffect(() => {\n    if (ref.current === null) return undefined;\n\n    let cleanup: () => void;\n\n    async function connect() {\n      cleanup = await useContext(\n        ref.current!,\n        [prop],\n        (_, newValue) => { setValue(newValue as any); },\n      );\n    }\n\n    connect();\n    return () => { cleanup?.(); };\n  }, [ref.current, prop]);\n\n  return [value, (setter as any)];\n};\n"]}