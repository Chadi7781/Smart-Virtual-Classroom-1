{"version":3,"file":"lib.js","sourceRoot":"","sources":["../../src/lib.tsx"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable react/prop-types */\nimport composeRefs from '@seznam/compose-react-refs';\nimport {\n  createElement, forwardRef, HTMLAttributes, useCallback, useEffect, useMemo, useRef, useState,\n} from 'react';\n\nexport const define = (tagName: string, clazz: any) => {\n  const isClient = (typeof window !== 'undefined');\n  if (isClient && !customElements.get(tagName)) customElements.define(tagName, clazz);\n};\n\nconst dashToPascalCase = (str: string) => str\n  .toLowerCase()\n  .split('-')\n  .map((segment) => segment.charAt(0).toUpperCase() + segment.slice(1))\n  .join('');\n\nconst isEvent = (prop: string) => prop.indexOf('on') === 0 && prop[2] === prop[2]?.toUpperCase();\nconst toDomEventName = (prop: string) => prop.charAt(2).toLowerCase() + prop.substring(3);\n\nexport function createComponent<T extends HTMLElement, P extends HTMLAttributes<any> = {}>(\n  tagName: string,\n  componentProps: Set<string>,\n) {\n  const Component = forwardRef<T, P>(({\n    children,\n    ...props\n  }, forwardedRef) => {\n    const [ref, setRef] = useState<T | null>(null);\n    const setRefCb = useCallback((node: T | null) => { setRef(node); }, []);\n    const eventHandlers = useRef(new Map());\n\n    const domProps = useMemo(() => Object.keys(props)\n      .filter((prop) => !componentProps.has(prop) && !isEvent(prop))\n      .reduce((p, c) => ({ ...p, [c]: (props as any)[c] }), {}), [props]);\n\n    const wcProps = useMemo(() => Object.keys(props)\n      .filter((prop) => componentProps.has(prop) || isEvent(prop))\n      .reduce((p, c) => ({ ...p, [c]: (props as any)[c] }), {}), [props]);\n\n    const listen = useCallback((prop: string, handler?: () => void) => {\n      const domEvent = toDomEventName(prop);\n      eventHandlers.current.get(domEvent)?.();\n      if (!ref || !handler) return;\n      ref!.addEventListener(domEvent, handler);\n      eventHandlers.current.set(domEvent, () => { ref!.removeEventListener(domEvent, handler); });\n    }, [ref]);\n\n    const cleanup = useCallback(() => {\n      eventHandlers.current.forEach((fn) => fn());\n      eventHandlers.current.clear();\n    }, []);\n\n    useEffect(() => () => { cleanup(); }, []);\n\n    useEffect(() => {\n      if (!ref) return;\n\n      Object.keys(wcProps).forEach((prop) => {\n        if (isEvent(prop)) {\n          listen(prop, (wcProps as any)[prop]);\n          return;\n        }\n\n        if ((ref as any)[prop] !== (wcProps as any)[prop]) {\n          ((ref as any)[prop] = (wcProps as any)[prop]);\n        }\n      });\n    }, [ref, wcProps]);\n\n    return createElement(tagName, {\n      ref: composeRefs(setRefCb, forwardedRef),\n      ...domProps,\n    }, children);\n  });\n\n  Component.displayName = dashToPascalCase(tagName);\n  return Component;\n}\n"]}