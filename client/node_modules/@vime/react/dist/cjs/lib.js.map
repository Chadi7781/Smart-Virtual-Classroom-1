{"version":3,"file":"lib.js","sourceRoot":"","sources":["../../src/lib.tsx"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable react/prop-types */\nimport composeRefs from '@seznam/compose-react-refs';\nimport {\n  createElement, forwardRef, HTMLAttributes, useCallback, useEffect, useMemo, useRef, useState,\n} from 'react';\n\nexport const define = (tagName: string, clazz: any) => {\n  const isClient = (typeof window !== 'undefined');\n  if (isClient && !customElements.get(tagName)) customElements.define(tagName, clazz);\n};\n\nconst dashToPascalCase = (str: string) => str\n  .toLowerCase()\n  .split('-')\n  .map((segment) => segment.charAt(0).toUpperCase() + segment.slice(1))\n  .join('');\n\nconst isEvent = (prop: string) => prop.indexOf('on') === 0 && prop[2] === prop[2]?.toUpperCase();\nconst toDomEventName = (prop: string) => prop.charAt(2).toLowerCase() + prop.substring(3);\n\nexport function createComponent<T extends HTMLElement, P extends HTMLAttributes<any> = {}>(\n  tagName: string,\n  componentProps: Set<string>,\n) {\n  const Component = forwardRef<T, P>(({\n    children,\n    ...props\n  }, forwardedRef) => {\n    const [ref, setRef] = useState<T | null>(null);\n    const setRefCb = useCallback((node: T | null) => { setRef(node); }, []);\n    const eventHandlers = useRef(new Map());\n\n    const domProps = useMemo(() => Object.keys(props)\n      .filter((prop) => !componentProps.has(prop) && !isEvent(prop))\n      .reduce((p, c) => ({ ...p, [c]: (props as any)[c] }), {}), [props]);\n\n    const wcProps = useMemo(() => Object.keys(props)\n      .filter((prop) => componentProps.has(prop) || isEvent(prop))\n      .reduce((p, c) => ({ ...p, [c]: (props as any)[c] }), {}), [props]);\n\n    const listen = useCallback((prop: string, handler?: () => void) => {\n      const domEvent = toDomEventName(prop);\n      eventHandlers.current.get(domEvent)?.();\n      if (!ref || !handler) return;\n      ref!.addEventListener(domEvent, handler);\n      eventHandlers.current.set(domEvent, () => { ref!.removeEventListener(domEvent, handler); });\n    }, [ref]);\n\n    const cleanup = useCallback(() => {\n      eventHandlers.current.forEach((fn) => fn());\n      eventHandlers.current.clear();\n    }, []);\n\n    useEffect(() => () => { cleanup(); }, []);\n\n    useEffect(() => {\n      if (!ref) return;\n\n      Object.keys(wcProps).forEach((prop) => {\n        if (isEvent(prop)) {\n          listen(prop, (wcProps as any)[prop]);\n          return;\n        }\n\n        if ((ref as any)[prop] !== (wcProps as any)[prop]) {\n          ((ref as any)[prop] = (wcProps as any)[prop]);\n        }\n      });\n    }, [ref, wcProps]);\n\n    return createElement(tagName, {\n      ref: composeRefs(setRefCb, forwardedRef),\n      ...domProps,\n    }, children);\n  });\n\n  Component.displayName = dashToPascalCase(tagName);\n  return Component;\n}\n"]}