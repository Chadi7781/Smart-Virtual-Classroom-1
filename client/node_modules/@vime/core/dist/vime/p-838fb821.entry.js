import{r as t,c as s,h as e}from"./p-f8abe418.js";import"./p-8acb8eb5.js";import{w as i,j as a,e as h}from"./p-29b5bd7f.js";import"./p-cdfa9679.js";import"./p-0cbaf141.js";import{V as r}from"./p-415151d7.js";import{M as n}from"./p-8b74fa0e.js";import"./p-121aab6e.js";import{w as o,c}from"./p-dff73e1a.js";import"./p-23929c27.js";import{d as l}from"./p-588e48e7.js";import{w as u}from"./p-5041b920.js";const d=new Map,m=class{constructor(e){t(this,e),this.vmLoadStart=s(this,"vmLoadStart",7),this.vmError=s(this,"vmError",7),this.defaultInternalState={},this.internalState={currentTime:0,volume:0,muted:!1,isAdsPlaying:!1,playbackReady:!1},this.embedSrc="",this.mediaTitle="",this.shouldAutoplayQueue=!1,this.showUpNextQueue=!1,this.showShareButtons=!1,this.showDailymotionLogo=!1,this.showVideoInfo=!0,this.language="en",this.autoplay=!1,this.controls=!1,this.loop=!1,this.muted=!1,this.playsinline=!1,i(this),o(this),u(this)}onVideoIdChange(){this.internalState={...this.defaultInternalState},this.videoId?(this.embedSrc=`${this.getOrigin()}/embed/video/${this.videoId}?api=1`,this.fetchVideoInfo=this.getVideoInfo(),this.pendingMediaTitleCall=a()):this.embedSrc=""}onControlsChange(){this.internalState.playbackReady&&this.remoteControl("controls",this.controls)}onCustomPosterChange(){this.dispatch("currentPoster",this.poster)}connectedCallback(){this.dispatch=c(this),this.dispatch("viewType",r.Video),this.onVideoIdChange(),this.initialMuted=this.muted,this.internalState.muted=this.muted,this.defaultInternalState={...this.internalState}}getOrigin(){return"https://www.dailymotion.com"}getPreconnections(){return[this.getOrigin(),"https://static1.dmcdn.net"]}remoteControl(t,s){return this.embed.postMessage({command:t,parameters:s?[s]:[]})}buildParams(){return{autoplay:this.autoplay,mute:this.initialMuted,"queue-autoplay-next":this.shouldAutoplayQueue,"queue-enable":this.showUpNextQueue,"sharing-enable":this.showShareButtons,syndication:this.syndication,"ui-highlight":this.color,"ui-logo":this.showDailymotionLogo,"ui-start-screen-info":this.showVideoInfo}}async getVideoInfo(){return d.has(this.videoId)?d.get(this.videoId):window.fetch(`https://api.dailymotion.com/video/${this.videoId}?fields=duration,thumbnail_1080_url`).then((t=>t.json())).then((t=>{const s=t.thumbnail_1080_url,e=parseFloat(t.duration);return d.set(this.videoId,{poster:s,duration:e}),{poster:s,duration:e}}))}onEmbedSrcChange(){this.vmLoadStart.emit(),this.dispatch("viewType",r.Video)}onEmbedMessage(t){const s=t.detail;switch(s.event){case"playback_ready":this.onControlsChange(),this.dispatch("currentSrc",this.embedSrc),this.dispatch("mediaType",n.Video),Promise.all([this.fetchVideoInfo,this.pendingMediaTitleCall?.promise]).then((([t,s])=>{this.dispatch("duration",t?.duration??-1),this.dispatch("currentPoster",this.poster??t?.poster),this.dispatch("mediaTitle",s),this.dispatch("playbackReady",!0)}));break;case"videochange":this.pendingMediaTitleCall?.resolve(s.title);break;case"start":this.dispatch("paused",!1),this.dispatch("playbackStarted",!0),this.dispatch("buffering",!0);break;case"video_start":this.remoteControl("muted",this.internalState.muted),this.remoteControl("volume",this.internalState.volume),this.internalState.currentTime>0&&this.remoteControl("seek",this.internalState.currentTime);break;case"play":this.dispatch("paused",!1);break;case"pause":this.dispatch("paused",!0),this.dispatch("playing",!1),this.dispatch("buffering",!1);break;case"playing":this.dispatch("playing",!0),this.dispatch("buffering",!1);break;case"video_end":this.loop?setTimeout((()=>{this.remoteControl("play")}),300):this.dispatch("playbackEnded",!0);break;case"timeupdate":this.dispatch("currentTime",parseFloat(s.time));break;case"volumechange":this.dispatch("muted","true"===s.muted),this.dispatch("volume",Math.floor(100*parseFloat(s.volume)));break;case"seeking":this.dispatch("currentTime",parseFloat(s.time)),this.dispatch("seeking",!0);break;case"seeked":this.dispatch("currentTime",parseFloat(s.time)),this.dispatch("seeking",!1);break;case"waiting":this.dispatch("buffering",!0);break;case"progress":this.dispatch("buffered",parseFloat(s.time));break;case"durationchange":this.dispatch("duration",parseFloat(s.duration));break;case"qualitiesavailable":this.dispatch("playbackQualities",s.qualities.map((t=>t+"p")));break;case"qualitychange":this.dispatch("playbackQuality",s.quality+"p");break;case"fullscreenchange":this.dispatch("isFullscreenActive","true"===s.fullscreen);break;case"error":this.vmError.emit(s.error)}}async getAdapter(){const t=/(?:dai\.ly|dailymotion|dailymotion\.com)\/(?:video\/|embed\/|)(?:video\/|)((?:\w)+)/;return{getInternalPlayer:async()=>this.embed,play:async()=>{this.remoteControl("play")},pause:async()=>{this.remoteControl("pause")},canPlay:async s=>h(s)&&t.test(s),setCurrentTime:async t=>{this.internalState.currentTime=t,this.remoteControl("seek",t)},setMuted:async t=>{this.internalState.muted=t,this.remoteControl("muted",t)},setVolume:async t=>{this.internalState.volume=t/100,this.dispatch("volume",t),this.remoteControl("volume",t/100)},canSetPlaybackQuality:async()=>!0,setPlaybackQuality:async t=>{this.remoteControl("quality",t.slice(0,-1))},canSetFullscreen:async()=>!0,enterFullscreen:async()=>{this.remoteControl("fullscreen",!0)},exitFullscreen:async()=>{this.remoteControl("fullscreen",!1)}}}render(){return e("vm-embed",{embedSrc:this.embedSrc,mediaTitle:this.mediaTitle,origin:this.getOrigin(),params:this.buildParams(),decoder:l,preconnections:this.getPreconnections(),onVmEmbedMessage:this.onEmbedMessage.bind(this),onVmEmbedSrcChange:this.onEmbedSrcChange.bind(this),ref:t=>{this.embed=t}})}static get watchers(){return{videoId:["onVideoIdChange"],controls:["onControlsChange"],poster:["onCustomPosterChange"]}}};m.style=":host{z-index:var(--vm-media-z-index)}";export{m as vm_dailymotion}