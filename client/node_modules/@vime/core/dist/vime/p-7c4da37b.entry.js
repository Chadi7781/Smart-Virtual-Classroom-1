import{r as s,c as t,h as i,g as e}from"./p-f8abe418.js";import{w as h,e as a,o as r,v as n}from"./p-29b5bd7f.js";import"./p-23929c27.js";import{c as o,p as c}from"./p-588e48e7.js";import{L as m}from"./p-3fb38170.js";let d=0;const p=new Set,l=class{constructor(i){s(this,i),this.vmEmbedSrcChange=t(this,"vmEmbedSrcChange",3),this.vmEmbedMessage=t(this,"vmEmbedMessage",3),this.vmEmbedLoaded=t(this,"vmEmbedLoaded",3),this.srcWithParams="",this.hasEnteredViewport=!1,this.embedSrc="",this.mediaTitle="",this.params="",this.preconnections=[],h(this)}onEmbedSrcChange(){this.srcWithParams=a(this.embedSrc)&&this.embedSrc.length>0?o(this.embedSrc,this.params):void 0}srcWithParamsChange(){r(this.srcWithParams)||this.hasEnteredViewport||p.has(this.embedSrc)||c(this.srcWithParams)&&p.add(this.embedSrc),this.vmEmbedSrcChange.emit(this.srcWithParams)}preconnectionsChange(){this.hasEnteredViewport||this.preconnections.filter((s=>!p.has(s))).forEach((s=>{c(s)&&p.add(s)}))}connectedCallback(){this.lazyLoader=new m(this.host,["data-src"],(s=>{const t=s.getAttribute("data-src");s.removeAttribute("src"),n(t)||s.setAttribute("src",t)})),this.onEmbedSrcChange(),this.genIframeId()}disconnectedCallback(){this.lazyLoader.destroy()}onWindowMessage(s){if(s.source!==this.iframe?.contentWindow||a(this.origin)&&this.origin!==s.origin)return;const t=this.decoder?.(s.data)??s.data;t&&this.vmEmbedMessage.emit(t)}async postMessage(s,t){this.iframe?.contentWindow?.postMessage(JSON.stringify(s),t??"*")}onLoad(){this.vmEmbedLoaded.emit()}genIframeId(){d+=1,this.id="vm-iframe-"+d}render(){return i("iframe",{id:this.id,class:"lazy",title:this.mediaTitle,"data-src":this.srcWithParams,allowFullScreen:!0,allow:"autoplay; encrypted-media; picture-in-picture;",onLoad:this.onLoad.bind(this),ref:s=>{this.iframe=s}})}get host(){return e(this)}static get watchers(){return{embedSrc:["onEmbedSrcChange"],params:["onEmbedSrcChange"],srcWithParams:["srcWithParamsChange"],preconnections:["preconnectionsChange"]}}};l.style=":host{z-index:var(--vm-media-z-index)}iframe{position:absolute;top:0;left:0;border:0;width:100%;height:100%;user-select:none}";export{l as vm_embed}