import{r as t,c as s,h as e}from"./p-f8abe418.js";import"./p-8acb8eb5.js";import{w as i,j as h,t as a,o as r,e as o}from"./p-29b5bd7f.js";import"./p-cdfa9679.js";import"./p-0cbaf141.js";import{V as n}from"./p-415151d7.js";import{M as c}from"./p-8b74fa0e.js";import"./p-121aab6e.js";import{w as d,c as m}from"./p-dff73e1a.js";import"./p-23929c27.js";import{a as p}from"./p-588e48e7.js";import{w as u}from"./p-5041b920.js";var l;!function(t){t.Play="play",t.Pause="pause",t.Seeking="seeking",t.Seeked="seeked",t.TimeUpdate="timeupdate",t.VolumeChange="volumechange",t.DurationChange="durationchange",t.FullscreenChange="fullscreenchange",t.CueChange="cuechange",t.Progress="progress",t.Error="error",t.PlaybackRateChange="playbackratechange",t.Loaded="loaded",t.BufferStart="bufferstart",t.BufferEnd="bufferend",t.TextTrackChange="texttrackchange",t.Waiting="waiting",t.Ended="ended"}(l||(l={}));const b=new Map,g=class{constructor(e){t(this,e),this.vmLoadStart=s(this,"vmLoadStart",7),this.vmError=s(this,"vmError",7),this.defaultInternalState={},this.volume=50,this.hasLoaded=!1,this.internalState={paused:!0,playing:!1,seeking:!1,currentTime:0,buffered:0,playbackStarted:!1,playRequest:!1},this.embedSrc="",this.mediaTitle="",this.byline=!0,this.portrait=!0,this.noAutoAspectRatio=!1,this.cookies=!0,this.language="en",this.aspectRatio="16:9",this.autoplay=!1,this.controls=!1,this.loop=!1,this.muted=!1,this.playsinline=!1,i(this),d(this),u(this)}onVideoIdChange(){this.cancelTimeUpdates(),this.videoId?(this.embedSrc=`${this.getOrigin()}/video/${this.videoId}`,this.pendingDurationCall=h(),this.pendingMediaTitleCall=h(),this.fetchVideoInfo=this.getVideoInfo()):this.embedSrc=""}onCustomPosterChange(){this.dispatch("currentPoster",this.poster)}connectedCallback(){this.dispatch=m(this),this.dispatch("viewType",n.Video),this.onVideoIdChange(),this.initialMuted=this.muted,this.defaultInternalState={...this.internalState}}disconnectedCallback(){this.cancelTimeUpdates(),this.pendingPlayRequest=void 0}getOrigin(){return"https://player.vimeo.com"}getPreconnections(){return[this.getOrigin(),"https://i.vimeocdn.com","https://f.vimeocdn.com","https://fresnel.vimeocdn.com"]}remoteControl(t,s){return this.embed.postMessage({method:t,value:s})}buildParams(){return{byline:this.byline,color:this.color,portrait:this.portrait,autopause:!1,transparent:!1,autoplay:this.autoplay,muted:this.initialMuted,playsinline:this.playsinline,dnt:!this.cookies}}async getVideoInfo(){return b.has(this.videoId)?b.get(this.videoId):window.fetch("https://vimeo.com/api/oembed.json?url="+this.embedSrc).then((t=>t.json())).then((t=>{const s={poster:`https://i.vimeocdn.com/video/${t?.thumbnail_url.match(/vimeocdn\.com\/video\/([0-9]+)/)[1]}_1920x1080.jpg`,width:t?.width,height:t?.height};return b.set(this.videoId,s),s}))}onTimeChange(t){this.internalState.currentTime!==t&&(this.dispatch("currentTime",t),Math.abs(this.internalState.currentTime-t)>1.5&&(this.internalState.seeking=!0,this.dispatch("seeking",!0),this.internalState.playing&&this.internalState.buffered<t&&this.dispatch("buffering",!0),window.clearTimeout(this.pendingPlayRequest),this.internalState.paused||(this.internalState.playRequest=!0),this.remoteControl(this.internalState.playbackStarted?"pause":"play")),this.internalState.currentTime=t)}cancelTimeUpdates(){a(this.timeRAF)&&window.cancelAnimationFrame(this.timeRAF)}requestTimeUpdates(){this.remoteControl("getCurrentTime"),this.timeRAF=window.requestAnimationFrame((()=>{this.requestTimeUpdates()}))}onSeeked(){this.internalState.seeking&&(this.dispatch("seeking",!1),this.internalState.seeking=!1,this.internalState.playRequest&&window.setTimeout((()=>{this.remoteControl("play")}),150))}onVimeoMethod(t,s){switch(t){case"getCurrentTime":this.internalState.seeking||this.onTimeChange(s);break;case"getDuration":this.pendingDurationCall?.resolve(s);break;case"getVideoTitle":this.pendingMediaTitleCall?.resolve(s)}}onLoaded(){this.hasLoaded||(this.pendingPlayRequest=void 0,this.internalState={...this.defaultInternalState},this.dispatch("currentSrc",this.embedSrc),this.dispatch("mediaType",c.Video),this.remoteControl("getDuration"),this.remoteControl("getVideoTitle"),Promise.all([this.fetchVideoInfo,this.pendingDurationCall?.promise,this.pendingMediaTitleCall?.promise]).then((([t,s,e])=>{this.requestTimeUpdates(),this.dispatch("aspectRatio",`${t?.width??16}:${t?.height??9}`),this.dispatch("currentPoster",this.poster??t?.poster),this.dispatch("duration",s??-1),this.dispatch("mediaTitle",e),this.dispatch("playbackReady",!0)})),this.hasLoaded=!0)}onVimeoEvent(t,s){switch(t){case"ready":Object.values(l).forEach((t=>{this.remoteControl("addEventListener",t)}));break;case"loaded":this.onLoaded();break;case"play":this.onLoaded(),this.internalState.paused=!1,this.dispatch("paused",!1);break;case"playProgress":this.internalState.playing||(this.dispatch("playing",!0),this.internalState.playing=!0,this.internalState.playbackStarted=!0,this.pendingPlayRequest=window.setTimeout((()=>{this.internalState.playRequest=!1,this.pendingPlayRequest=void 0}),1e3)),this.dispatch("buffering",!1),this.onSeeked();break;case"pause":this.internalState.paused=!0,this.internalState.playing=!1,this.dispatch("paused",!0),this.dispatch("buffering",!1);break;case"loadProgress":this.internalState.buffered=s.seconds,this.dispatch("buffered",s.seconds);break;case"bufferstart":this.dispatch("buffering",!0),this.internalState.paused&&(this.internalState.paused=!1,this.dispatch("paused",!1),this.dispatch("playbackStarted",!0));break;case"bufferend":this.dispatch("buffering",!1),this.internalState.paused&&this.onSeeked();break;case"volumechange":if(s.volume>0){const t=Math.floor(100*s.volume);this.dispatch("muted",!1),this.volume!==t&&(this.volume=t,this.dispatch("volume",this.volume))}else this.dispatch("muted",!0);break;case"durationchange":this.dispatch("duration",s.duration);break;case"playbackratechange":this.dispatch("playbackRate",s.playbackRate);break;case"fullscreenchange":this.dispatch("isFullscreenActive",s.fullscreen);break;case"finish":this.loop?(this.remoteControl("setCurrentTime",0),setTimeout((()=>{this.remoteControl("play")}),200)):this.dispatch("playbackEnded",!0);break;case"error":this.vmError.emit(s)}}onEmbedSrcChange(){this.hasLoaded=!1,this.vmLoadStart.emit(),this.dispatch("viewType",n.Video)}onEmbedMessage(t){const s=t.detail;r(s.event)||this.onVimeoEvent(s.event,s.data),r(s.method)||this.onVimeoMethod(s.method,s.value)}adjustPosition(){const[t,s]=this.aspectRatio.split(":").map((t=>parseInt(t,10)));return{paddingBottom:"240%",transform:`translateY(-${(240-100/t*s)/4.8+.02}%)`}}async getAdapter(){const t=/vimeo(?:\.com|)\/([0-9]{9,})/,s=/vimeo\.com\/external\/[0-9]+\..+/;return{getInternalPlayer:async()=>this.embed,play:async()=>{this.remoteControl("play")},pause:async()=>{this.remoteControl("pause")},canPlay:async e=>o(e)&&!s.test(e)&&t.test(e),setCurrentTime:async t=>{this.remoteControl("setCurrentTime",t)},setMuted:async t=>{t||(this.volume=this.volume>0?this.volume:30),this.remoteControl("setVolume",t?0:this.volume/100)},setVolume:async t=>{this.muted?this.dispatch("volume",t):this.remoteControl("setVolume",t/100)},canSetPlaybackRate:async()=>!1,setPlaybackRate:async t=>{this.remoteControl("setPlaybackRate",t)}}}render(){return e("vm-embed",{class:{hideControls:!this.controls},style:this.adjustPosition(),embedSrc:this.embedSrc,mediaTitle:this.mediaTitle,origin:this.getOrigin(),params:this.buildParams(),decoder:p,preconnections:this.getPreconnections(),onVmEmbedMessage:this.onEmbedMessage.bind(this),onVmEmbedSrcChange:this.onEmbedSrcChange.bind(this),ref:t=>{this.embed=t}})}static get watchers(){return{videoId:["onVideoIdChange"],poster:["onCustomPosterChange"]}}};g.style=":host{z-index:var(--vm-media-z-index)}vm-embed{position:absolute;top:0;left:0;width:100%;height:100%}vm-embed.hideControls{display:block;width:100%;height:auto;position:relative}";export{g as vm_vimeo}