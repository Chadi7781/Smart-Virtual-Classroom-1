import{r as t,c as s,h as i,g as e}from"./p-f8abe418.js";import"./p-8acb8eb5.js";import{D as h,w as a,b as n,m as r,v as o,o as c,t as l,e as d,l as u}from"./p-29b5bd7f.js";import"./p-cdfa9679.js";import"./p-0cbaf141.js";import{V as p}from"./p-415151d7.js";import{M as g}from"./p-8b74fa0e.js";import"./p-121aab6e.js";import{a as m,v as y,h as T}from"./p-b0ea4d0d.js";import{w as f,c as P}from"./p-dff73e1a.js";import{d as b,e as v,f as k,g as C,h as w}from"./p-23929c27.js";import{w as x}from"./p-5041b920.js";import{L as S}from"./p-3fb38170.js";const j=class{constructor(i){t(this,i),this.vmLoadStart=s(this,"vmLoadStart",7),this.vmError=s(this,"vmError",7),this.vmMediaElChange=s(this,"vmMediaElChange",7),this.vmSrcSetChange=s(this,"vmSrcSetChange",7),this.textTracksDisposal=new h,this.wasPausedBeforeSeeking=!0,this.currentSrcSet=[],this.mediaQueryDisposal=new h,this.willAttach=!1,this.preload="metadata",this.playbackRates=[.25,.5,.75,1,1.25,1.5,2],this.language="en",this.autoplay=!1,this.controls=!1,this.loop=!1,this.muted=!1,this.playsinline=!1,this.noConnect=!1,this.paused=!0,this.currentTime=0,this.volume=0,this.playbackReady=!1,this.playbackStarted=!1,this.currentTextTrack=-1,this.hasCustomTextManager=!1,this.isTextTrackVisible=!0,this.shouldRenderNativeTextTracks=!0,a(this),f(this),x(this,["playbackReady","playbackStarted","currentTime","volume","paused","currentTextTrack","isTextTrackVisible","shouldRenderNativeTextTracks"]),n(this,"vm-poster",(t=>{[this.vmPoster]=t}))}onMediaTitleChange(){this.dispatch("mediaTitle",this.mediaTitle)}onPosterChange(){this.playbackStarted||this.mediaEl?.load()}onViewTypeChange(){this.dispatch("viewType",this.viewType)}connectedCallback(){this.initLazyLoader(),this.dispatch=P(this),this.onViewTypeChange(),this.onPosterChange(),this.onMediaTitleChange()}componentDidRender(){this.prevMediaEl!==this.mediaEl&&(this.prevMediaEl=this.mediaEl,this.vmMediaElChange.emit(this.mediaEl))}componentDidLoad(){this.onViewTypeChange()}disconnectedCallback(){this.mediaQueryDisposal.empty(),this.textTracksDisposal.empty(),this.cancelTimeUpdates(),this.lazyLoader?.destroy(),this.wasPausedBeforeSeeking=!0}initLazyLoader(){this.lazyLoader=new S(this.host,["data-src","data-poster"],(()=>{if(r(this.mediaEl))return;const t=this.mediaEl.getAttribute("data-poster");o(t)||this.mediaEl.setAttribute("poster",t),this.refresh(),this.didSrcSetChange()}))}refresh(){if(r(this.mediaEl))return;const{children:t}=this.mediaEl;for(let s=0;s<=t.length-1;s+=1){const i=t[s],e=i.getAttribute("data-src")||i.getAttribute("src")||i.getAttribute("data-vs");i.removeAttribute("src"),o(e)||(i.setAttribute("data-vs",e),i.setAttribute("src",e))}}didSrcSetChange(){if(r(this.mediaEl))return;const t=Array.from(this.mediaEl.querySelectorAll("source")).map((t=>({src:t.getAttribute("data-vs"),media:t.getAttribute("data-media")??void 0,ref:t})));(this.currentSrcSet.length!==t.length||t.some(((t,s)=>this.currentSrcSet[s].src!==t.src)))&&(this.currentSrcSet=t,this.onSrcSetChange())}onSrcSetChange(){this.textTracksDisposal.empty(),this.mediaQueryDisposal.empty(),this.vmLoadStart.emit(),this.vmSrcSetChange.emit(this.currentSrcSet),this.willAttach||this.mediaEl?.load()}hasCustomPoster(){return!b&&!c(this.vmPoster)}cancelTimeUpdates(){l(this.timeRAF)&&window.cancelAnimationFrame(this.timeRAF),this.timeRAF=void 0}requestTimeUpdates(){this.dispatch("currentTime",this.mediaEl?.currentTime??0),this.timeRAF=window.requestAnimationFrame((()=>{this.requestTimeUpdates()}))}getMediaType(){const{currentSrc:t}=this.mediaEl;return m.test(t)?g.Audio:y.test(t)||T.test(t)?g.Video:void 0}onLoadedMetadata(){this.mediaEl.volume=this.volume/100,this.listenToTextTracksForChanges(),this.onTextTracksChange(),this.onProgress(),this.dispatch("currentPoster",this.poster),this.dispatch("duration",this.mediaEl.duration),this.dispatch("playbackRates",this.playbackRates),this.willAttach||(this.dispatch("currentSrc",this.mediaEl.currentSrc),this.dispatch("mediaType",this.getMediaType()),this.dispatch("playbackReady",!0))}onProgress(){const{buffered:t,duration:s}=this.mediaEl,i=0===t.length?0:t.end(t.length-1);this.dispatch("buffered",i>s?s:i)}onPlay(){this.requestTimeUpdates(),this.dispatch("paused",!1),this.playbackStarted||this.dispatch("playbackStarted",!0)}onPause(){this.cancelTimeUpdates(),this.dispatch("paused",!0),this.dispatch("buffering",!1)}onPlaying(){this.dispatch("playing",!0),this.dispatch("buffering",!1)}onSeeking(){this.wasPausedBeforeSeeking||(this.wasPausedBeforeSeeking=this.mediaEl.paused),this.dispatch("currentTime",this.mediaEl.currentTime),this.dispatch("seeking",!0)}onSeeked(){(0!==this.currentTime||this.playbackStarted)&&(this.dispatch("seeking",!1),this.playbackStarted&&this.wasPausedBeforeSeeking||this.attemptToPlay(),this.wasPausedBeforeSeeking=!0)}onRateChange(){this.dispatch("playbackRate",this.mediaEl.playbackRate)}onVolumeChange(){this.dispatch("muted",this.mediaEl.muted),this.dispatch("volume",100*this.mediaEl.volume)}onDurationChange(){this.dispatch("duration",this.mediaEl.duration)}onWaiting(){this.dispatch("buffering",!0)}onSuspend(){this.dispatch("buffering",!1)}onEnded(){this.loop||this.dispatch("playbackEnded",!0)}onError(){this.vmError.emit(this.mediaEl.error)}attemptToPlay(){try{this.mediaEl?.play()}catch(t){this.vmError.emit(t)}}togglePiPInChrome(t){return t?this.mediaEl?.requestPictureInPicture():document.exitPictureInPicture()}togglePiPInSafari(t){const s=t?"picture-in-picture":"inline";if(!this.mediaEl?.webkitSupportsPresentationMode(s))throw new Error("PiP API is not available.");return this.mediaEl?.webkitSetPresentationMode(s)}async togglePiP(t){if(v())return this.togglePiPInChrome(t);if(k())return this.togglePiPInSafari(t);throw new Error("PiP API is not available.")}async toggleFullscreen(t){if(!this.mediaEl?.webkitSupportsFullscreen)throw new Error("Fullscreen API is not available.");return t?this.mediaEl?.webkitEnterFullscreen():this.mediaEl?.webkitExitFullscreen()}onPresentationModeChange(){const t=this.mediaEl?.webkitPresentationMode;this.dispatch("isPiPActive","picture-in-picture"===t),this.dispatch("isFullscreenActive","fullscreen"===t)}onEnterPiP(){this.dispatch("isPiPActive",!0)}onLeavePiP(){this.dispatch("isPiPActive",!1)}async getAdapter(){return{getInternalPlayer:async()=>this.mediaEl,play:async()=>this.mediaEl?.play(),pause:async()=>this.mediaEl?.pause(),canPlay:async t=>d(t)&&(m.test(t)||y.test(t)),setCurrentTime:async t=>{this.mediaEl&&(this.mediaEl.currentTime=t)},setMuted:async t=>{this.mediaEl&&(this.mediaEl.muted=t)},setVolume:async t=>{this.mediaEl&&(this.mediaEl.volume=t/100)},canSetPlaybackRate:async()=>!0,setPlaybackRate:async t=>{this.mediaEl&&(this.mediaEl.playbackRate=t)},canSetPiP:async()=>C(),enterPiP:()=>this.togglePiP(!0),exitPiP:()=>this.togglePiP(!1),canSetFullscreen:async()=>w(),enterFullscreen:()=>this.toggleFullscreen(!0),exitFullscreen:()=>this.toggleFullscreen(!1),setCurrentTextTrack:async t=>{t!==this.currentTextTrack&&this.toggleTextTrackModes(t)},setTextTrackVisibility:async t=>{this.isTextTrackVisible=t,this.toggleTextTrackModes(this.currentTextTrack)}}}onHasCustomTextManagerChange(){this.hasCustomTextManager?this.textTracksDisposal.empty():this.playbackReady&&this.listenToTextTracksForChanges()}onShouldRenderNativeTextTracksChange(){this.hasCustomTextManager||this.toggleTextTrackModes(this.currentTextTrack)}onProviderConnect(t){this.noConnect&&t.stopImmediatePropagation()}onProviderDisconnect(t){this.noConnect&&t.stopImmediatePropagation()}getFilteredTextTracks(){const t=[],s=Array.from(this.mediaEl.textTracks);for(let i=0;i<s.length;i+=1){const e=s[i];"subtitles"!==e.kind&&"captions"!==e.kind||!e.label||t.push(s[i])}return t}listenToTextTracksForChanges(){this.hasCustomTextManager||(this.textTracksDisposal.empty(),c(this.mediaEl)||this.textTracksDisposal.add(u(this.mediaEl.textTracks,"change",this.onTextTracksChange.bind(this))))}onTextTracksChange(){const t=this.getFilteredTextTracks();let s=-1;for(let i=0;i<t.length;i+=1)if("hidden"===t[i].mode)s=i;else if("showing"===t[i].mode){s=i;break}this.shouldRenderNativeTextTracks||"showing"!==t[s]?.mode?(this.shouldRenderNativeTextTracks&&(this.isTextTrackVisible=-1!==s&&"showing"===t[s].mode,this.dispatch("isTextTrackVisible",this.isTextTrackVisible)),this.dispatch("textTracks",t),this.dispatch("currentTextTrack",this.shouldRenderNativeTextTracks&&!this.isTextTrackVisible?-1:s)):t[s].mode="hidden"}toggleTextTrackModes(t){if(r(this.mediaEl))return;const{textTracks:s}=this.mediaEl;if(-1===t)Array.from(s).forEach((t=>{t.mode="disabled"}));else{const t=s[this.currentTextTrack];t&&(t.mode="disabled")}const i=s[t];i&&(i.mode=this.isTextTrackVisible&&this.shouldRenderNativeTextTracks?"showing":"hidden"),this.dispatch("currentTextTrack",this.shouldRenderNativeTextTracks&&!this.isTextTrackVisible?-1:t),this.dispatch("isTextTrackVisible",this.isTextTrackVisible)}render(){const t={autoplay:this.autoplay,muted:this.muted,playsinline:this.playsinline,playsInline:this.playsinline,"x5-playsinline":this.playsinline,"webkit-playsinline":this.playsinline,controls:this.controls,crossorigin:""===this.crossOrigin?"anonymous":this.crossOrigin,controlslist:this.controlsList,"data-poster":this.hasCustomPoster()?void 0:this.poster,loop:this.loop,preload:this.preload,disablePictureInPicture:this.disablePiP,autoPictureInPicture:this.autoPiP,disableRemotePlayback:this.disableRemotePlayback,"x-webkit-airplay":this.disableRemotePlayback?"deny":"allow",ref:t=>{this.mediaEl=t},onLoadedMetadata:this.onLoadedMetadata.bind(this),onProgress:this.onProgress.bind(this),onPlay:this.onPlay.bind(this),onPause:this.onPause.bind(this),onPlaying:this.onPlaying.bind(this),onSeeking:this.onSeeking.bind(this),onSeeked:this.onSeeked.bind(this),onRateChange:this.onRateChange.bind(this),onVolumeChange:this.onVolumeChange.bind(this),onDurationChange:this.onDurationChange.bind(this),onWaiting:this.onWaiting.bind(this),onSuspend:this.onSuspend.bind(this),onEnded:this.onEnded.bind(this),onError:this.onError.bind(this)},s=i("audio",Object.assign({class:"lazy"},t),i("slot",null),"Your browser does not support the",i("code",null,"audio"),"element."),e=i("video",Object.assign({class:"lazy"},t,{onwebkitpresentationmodechanged:this.onPresentationModeChange.bind(this),onenterpictureinpicture:this.onEnterPiP.bind(this),onleavepictureinpicture:this.onLeavePiP.bind(this)}),i("slot",null),"Your browser does not support the",i("code",null,"video"),"element.");return this.viewType===p.Audio?s:e}get host(){return e(this)}static get watchers(){return{mediaTitle:["onMediaTitleChange"],poster:["onPosterChange"],viewType:["onViewTypeChange"],hasCustomTextManager:["onHasCustomTextManagerChange"],shouldRenderNativeTextTracks:["onShouldRenderNativeTextTracksChange"]}}};j.style="audio.sc-vm-file,video.sc-vm-file{border-radius:inherit;vertical-align:middle;width:100%;outline:0}video.sc-vm-file{position:absolute;top:0;left:0;border:0;height:100%;user-select:none}";export{j as vm_file}