import{r as t,c as s,h as e}from"./p-f8abe418.js";import"./p-8acb8eb5.js";import{w as i,e as a,k as h,t as n,n as r,u as o}from"./p-29b5bd7f.js";import"./p-cdfa9679.js";import"./p-0cbaf141.js";import{V as c}from"./p-415151d7.js";import{M as u}from"./p-8b74fa0e.js";import"./p-121aab6e.js";import{w as d,c as p}from"./p-dff73e1a.js";import"./p-23929c27.js";import{b as m,a as l}from"./p-588e48e7.js";import{w as b}from"./p-5041b920.js";const y=t=>{switch(t){case"unknown":return;case"tiny":return"144p";case"small":return"240p";case"medium":return"360p";case"large":return"480p";case"hd720":return"720p";case"hd1080":return"1080p";case"highres":return"1440p";case"max":return"2160p";default:return}},g=new Map,f=class{constructor(e){t(this,e),this.vmLoadStart=s(this,"vmLoadStart",7),this.defaultInternalState={},this.internalState={paused:!0,duration:0,seeking:!1,playbackReady:!1,playbackStarted:!1,currentTime:0,lastTimeUpdate:0,playbackRate:1,state:-1},this.embedSrc="",this.mediaTitle="",this.cookies=!1,this.showFullscreenControl=!0,this.language="en",this.autoplay=!1,this.controls=!1,this.loop=!1,this.muted=!1,this.playsinline=!1,i(this),d(this),b(this)}onVideoIdChange(){this.videoId?(this.embedSrc=`${this.getOrigin()}/embed/${this.videoId}`,this.fetchPosterURL=this.findPosterURL()):this.embedSrc=""}onCustomPosterChange(){this.dispatch("currentPoster",this.poster)}connectedCallback(){this.dispatch=p(this),this.dispatch("viewType",c.Video),this.onVideoIdChange(),this.initialMuted=this.muted,this.defaultInternalState={...this.internalState}}async getAdapter(){const t=/(?:youtu\.be|youtube|youtube\.com|youtube-nocookie\.com)\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=|)((?:\w|-){11})/;return{getInternalPlayer:async()=>this.embed,play:async()=>{this.remoteControl("playVideo")},pause:async()=>{this.remoteControl("pauseVideo")},canPlay:async s=>a(s)&&t.test(s),setCurrentTime:async t=>{this.remoteControl("seekTo",t)},setMuted:async t=>{this.remoteControl(t?"mute":"unMute")},setVolume:async t=>{this.remoteControl("setVolume",t)},canSetPlaybackRate:async()=>!0,setPlaybackRate:async t=>{this.remoteControl("setPlaybackRate",t)}}}getOrigin(){return this.cookies?"https://www.youtube.com":"https://www.youtube-nocookie.com"}getPreconnections(){return[this.getOrigin(),"https://www.google.com","https://googleads.g.doubleclick.net","https://static.doubleclick.net","https://s.ytimg.com","https://i.ytimg.com"]}remoteControl(t,s){return this.embed.postMessage({event:"command",func:t,args:s?[s]:void 0})}buildParams(){return{enablejsapi:1,cc_lang_pref:this.language,hl:this.language,fs:this.showFullscreenControl?1:0,controls:this.controls?1:0,disablekb:this.controls?0:1,iv_load_policy:this.controls?1:3,mute:this.initialMuted?1:0,playsinline:this.playsinline?1:0,autoplay:this.autoplay?1:0}}onEmbedSrcChange(){this.vmLoadStart.emit(),this.dispatch("viewType",c.Video)}onEmbedLoaded(){window.setTimeout((()=>this.embed.postMessage({event:"listening"})),100)}async findPosterURL(){if(g.has(this.videoId))return g.get(this.videoId);const t=t=>`https://i.ytimg.com/vi/${this.videoId}/${t}.jpg`;return m(t("maxresdefault"),121).catch((()=>m(t("sddefault"),121))).catch((()=>m(t("hqdefault"),121))).then((t=>{const s=t.src;return g.set(this.videoId,s),s}))}onCued(){this.internalState.playbackReady||(this.internalState={...this.defaultInternalState},this.dispatch("currentSrc",this.embedSrc),this.dispatch("mediaType",u.Video),this.fetchPosterURL.then((t=>{this.dispatch("currentPoster",this.poster??t),this.dispatch("playbackReady",!0)})),this.internalState.playbackReady=!0)}onPlayerStateChange(t){if(this.internalState.playbackReady&&-1===t)return this.internalState.paused=!0,this.internalState.playbackStarted=!1,this.dispatch("buffering",!1),this.dispatch("paused",!0),void this.dispatch("playbackStarted",!1);const s=1===t,e=3===t;switch(this.dispatch("buffering",e),this.internalState.paused&&(e||s)&&(this.internalState.paused=!1,this.dispatch("paused",!1),this.internalState.playbackStarted||(this.dispatch("playbackStarted",!0),this.internalState.playbackStarted=!0)),t){case 5:this.onCued();break;case 1:this.onCued(),this.dispatch("playing",!0);break;case 2:this.internalState.paused=!0,this.dispatch("paused",!0);break;case 0:this.loop?window.setTimeout((()=>{this.remoteControl("playVideo")}),150):(this.dispatch("playbackEnded",!0),this.internalState.paused=!0,this.dispatch("paused",!0))}this.internalState.state=t}calcCurrentTime(t){let s=t;if(0===this.internalState.state)return this.internalState.duration;if(1===this.internalState.state){const t=(Date.now()/1e3-this.defaultInternalState.lastTimeUpdate)*this.internalState.playbackRate;t>0&&(s+=Math.min(t,1))}return s}onTimeChange(t){const s=this.calcCurrentTime(t);this.dispatch("currentTime",s),Math.abs(this.internalState.currentTime-s)>1.5&&(this.internalState.seeking=!0,this.dispatch("seeking",!0)),this.internalState.currentTime=s}onBufferedChange(t){this.dispatch("buffered",t),this.internalState.seeking&&t>this.internalState.currentTime&&window.setTimeout((()=>{this.internalState.seeking=!1,this.dispatch("seeking",!1)}),this.internalState.paused?100:0)}onEmbedMessage(t){const s=t.detail,{info:e}=s;e&&(h(e.videoData)&&this.dispatch("mediaTitle",e.videoData.title),n(e.duration)&&(this.internalState.duration=e.duration,this.dispatch("duration",e.duration)),r(e.availablePlaybackRates)&&this.dispatch("playbackRates",e.availablePlaybackRates),n(e.playbackRate)&&(this.internalState.playbackRate=e.playbackRate,this.dispatch("playbackRate",e.playbackRate)),n(e.currentTime)&&this.onTimeChange(e.currentTime),n(e.currentTimeLastUpdated)&&(this.internalState.lastTimeUpdate=e.currentTimeLastUpdated),n(e.videoLoadedFraction)&&this.onBufferedChange(e.videoLoadedFraction*this.internalState.duration),n(e.volume)&&this.dispatch("volume",e.volume),o(e.muted)&&this.dispatch("muted",e.muted),r(e.availableQualityLevels)&&this.dispatch("playbackQualities",e.availableQualityLevels.map((t=>y(t)))),a(e.playbackQuality)&&this.dispatch("playbackQuality",y(e.playbackQuality)),n(e.playerState)&&this.onPlayerStateChange(e.playerState))}render(){return e("vm-embed",{embedSrc:this.embedSrc,mediaTitle:this.mediaTitle,origin:this.getOrigin(),params:this.buildParams(),decoder:l,preconnections:this.getPreconnections(),onVmEmbedLoaded:this.onEmbedLoaded.bind(this),onVmEmbedMessage:this.onEmbedMessage.bind(this),onVmEmbedSrcChange:this.onEmbedSrcChange.bind(this),ref:t=>{this.embed=t}})}static get watchers(){return{cookies:["onVideoIdChange"],videoId:["onVideoIdChange"],poster:["onCustomPosterChange"]}}};f.style=":host{z-index:var(--vm-media-z-index)}";export{f as vm_youtube}